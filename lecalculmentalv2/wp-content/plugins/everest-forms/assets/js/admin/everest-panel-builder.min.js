!function(v,p){var m={init:function(){v(document).ready(m.ready),v(window).on("load",m.load),m.bindUI()},ready:function(){jconfirm.defaults={closeIcon:!0,backgroundDismiss:!0,escapeKey:!0,animationBounce:1,useBootstrap:!1,theme:"modern",boxWidth:"400px",columnClass:"evf-responsive-class"},v(document).trigger("everest_forms_ready")},load:function(){},bindUI:function(){m.bindDefaultTabs(),m.checkEmptyGrid(),m.bindFields(),m.bindFormPreview(),m.bindGridSwitcher(),m.bindFieldSettings(),m.bindFieldDelete(),m.bindCloneField(),m.bindSaveOption(),m.bindFieldOptionChange(),m.bindAddNewRow(),m.bindRemoveRow(),m.bindFormSettings(),m.choicesInit(),m.choicesUpdate(),"field-options"===p.tab&&v(".evf-panel-field-options-button").trigger("click")},choicesInit:function(){var e=v(".evf-choices-list");e.sortable({out:function(e,i){var t=v(e.target).attr("data-field-id");m.choiceChange(t)}});var i=e.closest(".everest-forms-field-option").attr("data-field-id");v("#everest-forms-field-"+i)},choicesUpdate:function(){v(".evf-choices-list");v("body").on("click",".evf-choices-list a.add",function(){var e=v(this).closest("li").clone();e.find('input[type="text"]').val("");var i=v(this).closest(".evf-choices-list"),t=i.attr("data-field-id"),n=i.find("li").length;n++,e.find('input[type="checkbox"],input[type="radio"]').prop("checked",!1),e.attr("data-key",n),e.find(".default").attr("name","form_fields["+t+"][choices]["+n+"][default]"),e.find(".label").attr("name","form_fields["+t+"][choices]["+n+"][label]"),e.find(".value").attr("name","form_fields["+t+"][choices]["+n+"][value]"),v(this).closest("li").after(e),m.choiceChange(t)}),v("body").on("click",".evf-choices-list a.remove",function(){var e=v(this).closest(".evf-choices-list"),i=e.attr("data-field-id");e.find("li").length<2?v.alert({title:!1,content:p.i18n_field_error_choice,icon:"dashicons dashicons-info",type:"blue",buttons:{ok:{text:p.i18n_ok,btnClass:"btn-confirm",keys:["enter"]}}}):(v(this).closest("li").remove(),m.choiceChange(i))});v("body").on("keyup paste click",".evf-choices-list input",function(){var e=v(this).closest(".evf-choices-list").attr("data-field-id");"radio"===v(this).attr("type").toLowerCase()&&v(this).is(":checked")&&(v(this).closest(".evf-choices-list").find('input[type="radio"]').prop("checked",!1),v(this).prop("checked",!0)),m.choiceChange(e)})},choiceChange:function(e){var i=v("#everest-forms-field-option-row-"+e+"-choices"),t=v("#everest-forms-field-"+e),n=t.find("ul.primary-input"),o=i.find("ul.evf-choices-list").attr("data-field-type");"select"===o&&(n=t.find("select.primary-input")),n.html(""),v.each(i.find("ul.evf-choices-list").find("li"),function(){var e=v(this).find(".default").attr("type"),i=v("<li/>").append('<input type="'+e+'" disabled="">');"select"===o&&(i=v("<option/>"),v(this).find(".default").is(":checked")&&i.attr("selected","selected")),i.append(v(this).find(".label").val()),v(this).find(".default").is(":checked")&&i.find("input").prop("checked",!0),n.append(i)})},bindFormSettings:function(){v("body").on("click",".evf-setting-panel",function(e){var i=v(this).attr("data-section");v(".evf-setting-panel").removeClass("active"),v(".evf-content-section").removeClass("active"),v(this).addClass("active"),v(".evf-content-"+i+"-settings").addClass("active"),e.preventDefault()}),v(".evf-setting-panel").eq(0).trigger("click")},removeRow:function(e){v.each(e.find(".everest-forms-field"),function(){var e=v(this),i=e.attr("data-field-id"),t=v("#everest-forms-field-option-"+i);e.remove(),t.remove()}),e.remove()},bindRemoveRow:function(){v("body").on("click",".evf-delete-row",function(){var e=v(this).closest(".evf-admin-row");v(".evf-admin-row").length<2?v.alert({title:p.i18n_row_locked,content:p.i18n_row_locked_msg,icon:"dashicons dashicons-info",type:"blue",buttons:{confirm:{text:p.i18n_close,btnClass:"btn-confirm",keys:["enter"]}}}):v.confirm({title:!1,content:p.i18n_delete_row_confirm,type:"red",closeIcon:!1,backgroundDismiss:!1,icon:"dashicons dashicons-warning",buttons:{confirm:{text:p.i18n_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){m.removeRow(e)}},cancel:{text:p.i18n_cancel}}})})},bindAddNewRow:function(){v("body").on("click",".evf-add-row span",function(){var e=v(".evf-admin-row").eq(0).clone(),i=v(".evf-admin-row").length;e.find(".evf-admin-grid").html(""),e.attr("data-row-id",i+1),v(".evf-admin-field-wrapper").append(e),m.bindFields(),m.checkEmptyGrid()})},bindFieldOptionChange:function(){v("body").on("keyup paste click",'.everest-forms-field-option-row input[type="text"][name$="[label]"], .everest-forms-field-option-row textarea[name$="[description]"], .everest-forms-field-option-row input[type="checkbox"][name$="[required]"], .everest-forms-field-option-row input[type="checkbox"][name$="[label_hide]"], .everest-forms-field-option-row input[type="text"][name$="[placeholder]"]',function(){m.bindFormFieldChange(v(this))})},bindFormFieldChange:function(e){var i=e.closest(".everest-forms-field-option-row").attr("data-field-id"),t=v(".evf-admin-grid #everest-forms-field-"+i+".active"),n=e.attr("id");if("undefined"!==n&&n!==undefined)switch(n=n.replace("everest-forms-field-option-"+i+"-","")){case"label":t.find(".label-title .text").text(e.val());break;case"description":t.find(".description").html(e.val());break;case"required":e.is(":checked")?(t.find(".label-title .required").remove(),t.find(".label-title").append('<span class="required">*</span>')):t.find(".label-title .required").remove();break;case"label_hide":e.is(":checked")?t.find(".label-title").hide():t.find(".label-title").show();break;case"placeholder":t.find("input").attr("placeholder",e.val())}},bindCloneField:function(){v("body").on("click",".everest-forms-preview .everest-forms-field .everest-forms-field-duplicate",function(){var e=v(this).closest(".everest-forms-field");e.hasClass("no-duplicate")?v.alert({title:p.i18n_field_locked,content:p.i18n_field_locked_msg,icon:"dashicons dashicons-info",type:"blue",buttons:{confirm:{text:p.i18n_close,btnClass:"btn-confirm",keys:["enter"]}}}):v.confirm({title:!1,content:p.i18n_duplicate_field_confirm,type:"orange",closeIcon:!1,backgroundDismiss:!1,icon:"dashicons dashicons-warning",buttons:{confirm:{text:p.i18n_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){m.cloneFieldAction(e)}},cancel:{text:p.i18n_cancel}}})})},cloneFieldAction:function(n){var o=n.attr("data-field-id"),e=p.form_id,i={action:"everest_forms_get_next_id",security:p.evf_get_next_id,form_id:e};v.ajax({url:p.ajax_url,data:i,type:"POST",beforeSend:function(){},success:function(e){if("boolean"==typeof e.success&&!0===e.success){var i=e.data.field_id,t=e.data.field_key;v("#everest-forms-field-id").val(i),m.render_node(n,o,t)}}})},render_node:function(e,o,r){var i=v(".everest-forms-field-options #everest-forms-field-option-"+o),t=v("#everest-forms-field-option-"+o+"-label").val(),n=e.attr("data-field-type"),s=i.html(),a=p.copy_of+t,d=t.replace(" ","_").toLowerCase()+"_"+Math.floor(1e3+9e3*Math.random()),l=e.clone(),f=new RegExp(o,"g");s=s.replace(f,r);var c=v('<div class="everest-forms-field-option everest-forms-field-option-'+n+'" id="everest-forms-field-option-'+r+'" data-field-id="'+r+'" />');c.append(s),v.each(i.find(":input"),function(){var e=v(this).attr("type"),i=v(this).attr("name").replace(f,r),t="";if("text"===e||"hidden"===e)t=v(this).val(),c.find('input[name="'+i+'"]').val(t),c.find('input[value="'+o+'"]').val(r);else if("checkbox"===e||"radio"===e)v(this).is(":checked")?c.find('input[name="'+i+'"]').prop("checked",!0).attr("checked","checked"):c.find('[name="'+i+'"]').prop("checked",!1).attr("checked",!1);else if(v(this).is("select")){if(v(this).find("option:selected").length){var n=v(this).find("option:selected").val();c.find('[name="'+i+'"]').find('[value="'+n+'"]').prop("selected",!0)}}else""!==v(this).val()&&c.find('[name="'+i+'"]').val(v(this).val())}),v(".everest-forms-field-options").append(c),v("#everest-forms-field-option-"+r+"-label").val(a),v("#everest-forms-field-option-"+r+"-meta-key").val(d),l.attr("class",e.attr("class")),l.attr("id","everest-forms-field-"+r),l.attr("data-field-id",r),l.attr("data-field-type",n),l.find(".label-title .text").text(a),e.closest(".evf-admin-grid").find('[data-field-id="'+o+'"]').after(l),v(document).trigger("everest-form-cloned",[r,n]),m.switchToFieldOptionPanel(r)},bindFieldDelete:function(){v("body").on("click",".everest-forms-preview .everest-forms-field .everest-forms-field-delete",function(){var e=v(this).closest(".everest-forms-field"),i=e.attr("data-field-id"),t=v("#everest-forms-field-option-"+i),n=v(this).closest(".evf-admin-grid");e.hasClass("no-delete")?v.alert({title:p.i18n_field_locked,content:p.i18n_field_locked_msg,icon:"dashicons dashicons-info",type:"blue",buttons:{confirm:{text:p.i18n_close,btnClass:"btn-confirm",keys:["enter"]}}}):v.confirm({title:!1,content:p.i18n_delete_field_confirm,type:"orange",closeIcon:!1,backgroundDismiss:!1,icon:"dashicons dashicons-warning",buttons:{confirm:{text:p.i18n_ok,btnClass:"btn-confirm",keys:["enter"],action:function(){v(".evf-panel-fields-button").trigger("click"),e.fadeOut("slow",function(){e.remove(),t.remove()}),1===n.children().length&&n.addClass("evf-empty-grid")}},cancel:{text:p.i18n_cancel}}})})},bindSaveOption:function(){v("body").on("click",".evf_save_form_action_button",function(){var i=v(this),e=v("form#everest-forms-builder-form"),t=m.getStructure(),n=e.serializeArray(),o=[];v(".everest-forms-field[data-field-id]").each(function(){o.push(v(this).attr("data-field-id"))});for(var r=n.length;r--;)if(n[r].name.startsWith("form_fields")){var s=!1;o.forEach(function(e){n[r].name.startsWith("form_fields["+e+"]")&&(s=!0)}),-1<r&&!1===s&&n.splice(r,1)}var a=n.concat(t),d={action:"everest_forms_save_form",security:p.evf_save_form,form_data:JSON.stringify(a)},l=v("#everest-forms-builder");v.ajax({url:p.ajax_url,data:d,type:"POST",beforeSend:function(){var e=v('<div class="evf-overlay"></div>');e.append('<div class="loading"></div>'),i.find(".spinner").remove(),l.find(".evf-overlay").remove(),l.css({position:"relative"}),l.append(e),i.append('<span style="margin-top:-1px;margin-right:0;" class="spinner is-active"></span>')},success:function(e){l.find(".evf-overlay").fadeOut(),l.find(".evf-overlay").remove(),l.removeAttr("style"),i.find(".spinner").remove(),"boolean"==typeof e.success&&!0===e.success&&window.location.reload()}})})},getStructure:function(){var e=v(".evf-admin-field-wrapper"),r=[];return v.each(e.find(".evf-admin-row"),function(){var e=v(this),o=e.attr("data-row-id");v.each(e.find(".evf-admin-grid"),function(){var e=v(this),t=e.attr("data-grid-id"),n=0;v.each(e.find(".everest-forms-field"),function(){var e={name:"",value:""},i=v(this).attr("data-field-id");e.name="structure[row_"+o+"][grid_"+t+"]["+n+"]",n++,e.value=i,r.push(e)}),e.find(".everest-forms-field").length<1&&r.push({name:"structure[row_"+o+"][grid_"+t+"]",value:""})})}),r},getFieldArray:function(e){var i=[];return v.each(e.find(".everest-forms-field"),function(){var e=v(this).attr("data-field-id");i.push(e)}),i},checkEmptyGrid:function(){v.each(v(".evf-admin-grid"),function(){v(this).find(".everest-forms-field").length<1?v(this).addClass("evf-empty-grid"):v(this).removeClass("evf-empty-grid")}),m.choicesInit()},bindDefaultTabs:function(){v(document).on("click","#evf-builder-tabs li",function(e){e.preventDefault(),m.switchTab(v(this).data("panel"))})},switchTab:function(e){var i=v("#everest-forms-panel-"+e),t=v(".evf-panel-"+e+"-button");v("#evf-builder-tabs").find("li a").removeClass("active"),t.find("a").addClass("active"),i.closest(".evf-tab-content").find(".everest-forms-panel").removeClass("active"),i.addClass("active"),"fields"===e&&(v(".everest-forms-field-options").hide(),v(".everest-forms-add-fields").show()),history.replaceState({},null,m.updateQueryString("tab",e)),m.switchPanel(e)},updateQueryString:function(e,i,t){t||(t=window.location.href);var n,o=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(o.test(t))return null!=i?t.replace(o,"$1"+e+"="+i+"$2$3"):(t=(n=t.split("#"))[0].replace(o,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof n[1]&&null!==n[1]&&(t+="#"+n[1]),t);if(null!=i){var r=-1!==t.indexOf("?")?"&":"?";return t=(n=t.split("#"))[0]+r+e+"="+i,"undefined"!=typeof n[1]&&null!==n[1]&&(t+="#"+n[1]),t}return t},switchPanel:function(e){"field-options"===e&&m.switchToFieldOptionPanel()},switchToFieldOptionPanel:function(e){v("li.evf-panel-field-options-button.evf-disabled-tab").show(),v(".everest-forms-field-options").find(".no-fields").hide(),v(".evf-admin-field-wrapper .everest-forms-field").removeClass("active"),v(".everest-forms-panel").removeClass("active"),v("#everest-forms-panel-fields").addClass("active"),v(".everest-forms-add-fields").hide(),v(".everest-forms-field-options").show(),v(".everest-forms-field-options").find(".everest-forms-field-option").hide(),v(".evf-tab-lists").find("li a").removeClass("active"),v(".evf-tab-lists").find("li.evf-panel-field-options-button a").addClass("active"),void 0!==e?(v("#everest-forms-field-option-"+e).show(),v("#everest-forms-field-"+e).addClass("active")):0<v(".evf-admin-field-wrapper .everest-forms-field").length?(v(".evf-admin-field-wrapper .everest-forms-field").eq(0).addClass("active"),v("#everest-forms-field-option-"+v(".evf-admin-field-wrapper .everest-forms-field").eq(0).attr("data-field-id")).show()):v(".everest-forms-field-options").find(".no-fields").show()},bindFields:function(){v(".evf-admin-grid").sortable({containment:".evf-admin-field-wrapper",cancel:!1,over:function(e,i){v(e.target).addClass("evf-item-hover"),v(".evf-admin-grid").addClass("evf-hover"),m.checkEmptyGrid()},out:function(e,i){v(".evf-admin-grid").removeClass("evf-hover"),v(e.target).removeClass("evf-item-hover"),m.checkEmptyGrid()},revert:!0,connectWith:".evf-admin-grid"}).disableSelection(),v(".evf-admin-field-wrapper").sortable({containment:".evf-admin-field-wrapper",tolerance:"pointer",revert:"invalid",placeholder:"evf-admin-row",forceHelperSize:!0,over:function(){v(".evf-admin-field-wrapper").addClass("evf-hover")},out:function(){v(".evf-admin-field-wrapper").removeClass("evf-hover")}}),v(".evf-registered-buttons button.evf-registered-item").draggable({connectToSortable:".evf-admin-grid",containment:"#everest-forms-builder",helper:"clone",cancel:!1,scroll:!1,delay:200,opacity:.75,start:function(e,i){v(".evf-admin-grid").addClass("evf-hover"),v(this).data("uihelper",i.helper)},revert:function(e){return this.data("uihelper").data("dropped",!1!==e),!1===e},stop:function(e,i){if(!0===i.helper.data("dropped")){v(".evf-admin-grid").removeClass("evf-hover");var t=i.helper;m.fieldDrop(t)}}}).disableSelection()},bindFormPreview:function(){},bindGridSwitcher:function(){v("body").on("click",".evf-show-grid",function(){v(this).closest(".evf-toggle-row").find(".evf-toggle-row-content").slideToggle(200)});v("body").on("click",".evf-grid-selector",function(){var e=v(this).closest(".evf-admin-row");if(!v(this).hasClass("active")){var i=parseInt(v(this).attr("data-evf-grid"),10);if(!(2<i)){var t=v('<div class="evf-admin-grid evf-grid-'+i+' ui-sortable" />'),n=v("<div/>");v.each(e.find(".evf-admin-grid"),function(){v(this).children("*").each(function(){n.append(v(this).clone())})}),e.find(".evf-admin-grid").remove(),e.find(".evf-clear ").remove(),e.append('<div class="clear evf-clear"></div>');for(var o=1;o<=i;o++)t.attr("data-grid-id",o),e.append(t.clone());e.append('<div class="clear evf-clear"></div>'),e.find(".evf-admin-grid").eq(0).append(n.html()),e.find(".evf-grid-selector").removeClass("active"),v(this).addClass("active"),m.bindFields()}}})},fieldDrop:function(o){var e=o.attr("data-field-type");o.css({width:"100%",left:"0"}),o.append('<i class="spinner is-active" style="margin: 0;padding: 0;"></i>');var i={action:"everest_forms_new_field_"+e,security:p.evf_field_drop_nonce,field_type:e,form_id:p.form_id};v.ajax({url:p.ajax_url,data:i,type:"POST",beforeSend:function(){v(document.body).trigger("init_fields_toogle")},success:function(e){var i=e.data.preview,t=e.data.options,n=e.data.form_field_id;v("#everest-forms-field-id").val(n),v(".everest-forms-field-options").find(".no-fields").hide(),v(".everest-forms-field-options").append(t),o.after(i),o.remove(),m.checkEmptyGrid(),v(document.body).trigger("init_tooltips"),v(document.body).trigger("init_fields_toogle")}})},bindFieldSettings:function(){v("body").on("click",".everest-forms-preview .everest-forms-field, .everest-forms-preview .everest-forms-field .everest-forms-field-setting",function(){var e=v(this).closest(".everest-forms-field").attr("data-field-id");m.switchToFieldOptionPanel(e)})}};v(function(){m.init()})}(jQuery,window.evf_data),jQuery(function(){var e=jQuery("#everest-forms-panel-field-settings-redirect_to option:selected").val();"0"==e?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"1"==e?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").show(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"2"==e&&(jQuery("#everest-forms-panel-field-settings-external_url-wrap").show(),jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide()),jQuery("#everest-forms-panel-field-settings-redirect_to").on("change",function(){"0"==this.value?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"1"==this.value?(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").show(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").hide()):"2"==this.value&&(jQuery("#everest-forms-panel-field-settings-custom_page-wrap").hide(),jQuery("#everest-forms-panel-field-settings-external_url-wrap").show())}),jQuery("li.evf-panel-field-options-button.evf-disabled-tab").hide()}),jQuery(function(i){i(document.body).on("init_tooltips",function(){i(".tips, .help_tip, .everest-forms-help-tooltip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})}).trigger("init_tooltips"),i(".everest-forms-tab-content").on("click",".everest-forms-add-fields-group > a",function(e){e.preventDefault()}),i(document.body).on("init_fields_toogle",function(){i(".everest-forms-field-option").on("click",".everest-forms-field-option-group > a",function(e){e.preventDefault(),i(this).parent(".everest-forms-field-option-group").toggleClass("closed").toggleClass("open")}),i(".everest-forms-field-option").on("click",".everest-forms-field-option-group a",function(e){i(e.target).filter(":input, option, .sort").length||i(this).next(".everest-forms-field-option-group-inner").stop().slideToggle()}),i(".everest-forms-field-option-group.closed").each(function(){i(this).find(".everest-forms-field-option-group-inner").hide()})}).trigger("init_fields_toogle")});